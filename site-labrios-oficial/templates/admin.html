{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Painel Gestor</h2>
        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">Visualizar Site</a>
    </div>

    <!-- FILA DE ESPERA -->
    <div class="card mb-4">
        <div class="card-header bg-warning">Fila de Espera (Solicitações Pendentes)</div>
        <div class="card-body p-0">
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>Equipamento</th>
                        <th>Pesquisador</th>
                        <th>Instituição</th>
                        <th>Horário</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for res in pending_reservations %}
                    <tr>
                        <td>{{ res.equipment.name }}</td>
                        <td>{{ res.name }}</td>
                        <td>{{ res.institution }}</td>
                        <td>{{ res.date }} ({{ res.start_time }}-{{ res.end_time }})</td>
                        <td>
                            <form action="{{ url_for('approve_reservation', id=res.id) }}" method="POST" class="d-inline">
                                <button class="btn btn-sm btn-success">Aprovar</button>
                            </form>
                            <form action="{{ url_for('reject_reservation', id=res.id) }}" method="POST" class="d-inline">
                                <button class="btn btn-sm btn-danger">Recusar</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="text-center">Nenhuma solicitação pendente.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- MEMBROS E COMITÊS -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">Gestão de Comitês e Equipe</div>
        <div class="card-body">
            <form action="{{ url_for('add_member') }}" method="POST" enctype="multipart/form-data" class="row g-3 mb-4">
                <div class="col-md-3">
                    <input type="text" name="name" class="form-control" placeholder="Nome" required>
                </div>
                <div class="col-md-2">
                    <input type="text" name="role" class="form-control" placeholder="Função">
                </div>
                <div class="col-md-3">
                    <input type="url" name="lattes" class="form-control" placeholder="Link Lattes">
                </div>
                <div class="col-md-2">
                    <select name="committee_type" class="form-select">
                        <option value="Equipe">Equipe Geral</option>
                        <option value="Gestor">Comitê Gestor</option>
                        <option value="Científico">Comitê Científico</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="file" name="photo" class="form-control">
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-info w-100 text-white">Cadastrar Membro</button>
                </div>
            </form>

            <table class="table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Função</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in members %}
                    <tr>
                        <td>{{ m.name }}</td>
                        <td><span class="badge bg-secondary">{{ m.committee_type }}</span></td>
                        <td>{{ m.role }}</td>
                        <td>
                            <form action="{{ url_for('delete_member', id=m.id) }}" method="POST">
                                <button class="btn btn-sm btn-outline-danger">x</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- CONFIGURAÇÕES GERAIS -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-dark text-white">Configurações Gerais</div>
        <div class="card-body">
            <form action="{{ url_for('update_settings') }}" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label">Nome do Laboratório</label>
                    <input type="text" name="lab_name" class="form-control" value="{{ settings.lab_name }}">
                </div>
                <div class="mb-3">
                    <label class="form-label">Link do Formulário de Reserva (Externo)</label>
                    <input type="url" name="form_link" class="form-control" value="{{ settings.external_form_link }}">
                </div>
                <div class="mb-3">
                    <label class="form-label">Texto de Boas-Vindas</label>
                    <textarea name="hero_text" class="form-control" rows="3">{{ settings.hero_text }}</textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Atualizar Regimento (PDF no Banco)</label>
                    <input type="file" name="regimento" class="form-control" accept="application/pdf">
                </div>
                <button type="submit" class="btn btn-success w-100">Salvar Alterações</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
